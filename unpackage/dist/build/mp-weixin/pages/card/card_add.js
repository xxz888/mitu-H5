(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/card/card_add"],{"000e":function(e,n,t){"use strict";(function(e){t("3335");a(t("66fd"));var n=a(t("02cd"));function a(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])},"02cd":function(e,n,t){"use strict";t.r(n);var a=t("6050"),o=t("4698");for(var c in o)"default"!==c&&function(e){t.d(n,e,(function(){return o[e]}))}(c);t("c825");var i,r=t("f0c5"),s=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],i);n["default"]=s.exports},4698:function(e,n,t){"use strict";t.r(n);var a=t("eb9d"),o=t.n(a);for(var c in a)"default"!==c&&function(e){t.d(n,e,(function(){return a[e]}))}(c);n["default"]=o.a},6050:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return c})),t.d(n,"a",(function(){return a}));var a={wCompress:function(){return Promise.all([t.e("common/vendor"),t.e("components/w-compress/w-compress")]).then(t.bind(null,"c79e"))}},o=function(){var e=this,n=e.$createElement;e._self._c},c=[]},"83f0":function(e,n,t){},c825:function(e,n,t){"use strict";var a=t("83f0"),o=t.n(a);o.a},eb9d:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=function(){Promise.all([t.e("common/vendor"),t.e("components/w-compress/w-compress")]).then(function(){return resolve(t("c79e"))}.bind(null,t)).catch(t.oe)},o={components:{WCompress:a},data:function(){return{showhb:0,bankName:"",fullName:"",bankcard:"",phone:"",expiredTime:"",securityCode:"",billDay:"",repaymentDay:""}},onShow:function(){},onLoad:function(e){this.api_getUser()},methods:{onSinngle:function(){var n=this;e.chooseImage({count:1,success:function(e){n.$refs.wCompress.start(e.tempFilePaths[0],{pixels:1e5,quality:.8,type:"png",base64:!1}).then((function(e){n.single=e,n.savePicture(e)})).catch((function(e){console.log(e)}))}})},savePicture:function(n){for(var t=n.split(","),a=atob(t[1]),o=new ArrayBuffer(a.length),c=new Uint8Array(o),i=0;i<a.length;i++)c[i]=a.charCodeAt(i);var r=new Blob([o],{type:"application/octet-stream"}),s=URL.createObjectURL(r);console.log("url===",s);var l=this;l.camera=s;var u={filePath:s};l.$api.api_ocrUploadBankcard(u).then((function(n){var t=JSON.parse(n.data);console.log("r.code",t),0==t.code?(l.bankcard=t.data.card_number,l.bankName=t.data.bank_name):e.showToast({title:"解析失败",icon:"none"})})).catch((function(n){e.showToast({title:"网络链接失败",icon:"none"})}))},goback:function(){this.showhb=0,e.navigateBack({})},api_getUser:function(){var n=this,t={id:e.getStorageSync("users").id};this.$meapi.api_getUser(t).then((function(e){console.log("首页获取个人信息成功成功",e.data.selfLevel),0==e.code&&(n.fullName=e.data.fullname)})).catch((function(n){console.log("api_changeAlipay失败",n),e.showToast({title:"网络链接失败",icon:"none"})}))},photo:function(){var n=this,t=this;console.log("上传图片"),e.chooseImage({count:1,success:function(a){console.log("res.tempFilePaths[0]",a.tempFilePaths[0]);var o={filePath:a.tempFilePaths[0]};t.$api.api_ocrUploadBankcard(o).then((function(e){var t=JSON.parse(e.data);console.log("bankcard",JSON.parse(e.data)),n.bankcard=t.data.card_number,n.bankName=t.data.bank_name})).catch((function(n){e.showToast({title:"网络链接失败",icon:"none"})}))}})},bindCard:function(){var n=this,t=this;if(t.bankcard.length<10||11!=t.phone.length||4!=t.expiredTime.length||3!=t.securityCode.length||0==t.billDay.length||0==t.repaymentDay.length)return console.log(t.bankcard.length,t.phone.length,t.expiredTime.length,t.securityCode.length,t.billDay.length,t.repaymentDay.length),void e.showToast({title:"请先完善资料",icon:"none"});var a={bankName:t.bankName,fullname:t.fullName,bankcard:t.bankcard,phone:t.phone,expiredTime:t.expiredTime,securityCode:t.securityCode,billDay:t.billDay,repaymentDay:t.repaymentDay};this.$api.api_bindCard(a).then((function(t){if(console.log("api_bindCard成功",t),0==t.code)if("first"==t.message)n.showhb=1;else{e.showToast({title:"添加成功"});setTimeout((function(){e.navigateBack({})}),500)}else e.showToast({title:t.message,icon:"none"})})).catch((function(n){console.log("api_bindCard失败",n),e.showToast({title:"网络链接失败",icon:"none"})}))},back:function(){e.navigateBack({})}}};n.default=o}).call(this,t("543d")["default"])}},[["000e","common/runtime","common/vendor"]]]);